"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["7814"],{57484:function(e,t,a){a.d(t,{AO:()=>n,Sz:()=>i});let n={userMemberships:{infinite:!0},userInvitations:{infinite:!0},userSuggestions:{infinite:!0,status:["pending","accepted"]}},i=(e,t,a)=>{var n;if(void 0===t)return[{data:[e],total_count:1}];let i=(null==t||null==(n=t[t.length-1])?void 0:n.total_count)||1;return t.map(t=>{if(void 0===t)return t;let n=t.data.map(t=>t.id===e.id?{...e}:t);return{...t,data:n,total_count:"negative"===a?i-1:i}})}},33738:function(e,t,a){a.r(t),a.d(t,{TaskChooseOrganization:()=>A}),a(65223);var n=a(73312),i=a(61869),o=a(69144),r=a(11576),l=a(64204),s=a(92418),c=a(2672),d=a(54264),u=a(76028),g=a(25135),h=a(41024),z=a(20237),p=a(57484),v=a(86988),m=a(42305),C=a(92654),O=a(35973),k=a(96519),y=a(88870);let _=e=>{var t,a,i;let o=(0,c.useCardState)(),{ref:r,userMemberships:d,userSuggestions:g,userInvitations:h}=(0,u.H)(),p=(null==d?void 0:d.isLoading)||(null==h?void 0:h.isLoading)||(null==g?void 0:g.isLoading),v=(null==d?void 0:d.hasNextPage)||(null==h?void 0:h.hasNextPage)||(null==g?void 0:g.hasNextPage),O=null==(t=h.data)?void 0:t.filter(e=>!!e),k=null==(a=g.data)?void 0:a.filter(e=>!!e);return(0,n.BX)(n.HY,{children:[(0,n.BX)(C.h.Root,{showLogo:!0,sx:e=>({padding:"".concat(e.space.$none," ").concat(e.space.$8)}),children:[(0,n.tZ)(C.h.Title,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.title")}),(0,n.tZ)(C.h.Subtitle,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.subtitle")})]}),(0,n.tZ)(s.Z.Alert,{sx:e=>({margin:"".concat(e.space.$none," ").concat(e.space.$8)}),children:o.error}),(0,n.tZ)(l.Col,{elementDescriptor:l.descriptors.main,children:(0,n.tZ)(z.o2,{elementDescriptor:l.descriptors.taskChooseOrganizationPreviewItems,children:(0,n.BX)(m.eX,{role:"menu",children:[(d.count||0)>0&&(null==(i=d.data)?void 0:i.map(e=>(0,n.tZ)(Z,{...e},e.id))),!d.hasNextPage&&(null==O?void 0:O.map(e=>(0,n.tZ)(b,{...e},e.id))),!d.hasNextPage&&!h.hasNextPage&&(null==k?void 0:k.map(e=>(0,n.tZ)(S,{...e},e.id))),(v||p)&&(0,n.tZ)(z.pr,{ref:r}),(0,n.tZ)(w,{onCreateOrganizationClick:()=>{o.setError(void 0),e.onCreateOrganizationClick()}})]})})})]})},Z=e=>{let{user:t}=(0,i.aF)(),a=(0,c.useCardState)(),{navigateOnSetActive:o}=(0,v.G)(),{redirectUrlComplete:r}=(0,v._)(),{isLoaded:s,setActive:d}=(0,i.eW)(),{t:u}=(0,l.useLocalizations)();return s?(0,n.tZ)(z.Td,{elementDescriptor:l.descriptors.taskChooseOrganizationPreviewButton,onClick:()=>{let n;return n=e.organization,a.runAsync(async()=>{try{await d({organization:n,navigate:async e=>{let{session:t}=e;await (null==o?void 0:o({session:t,redirectUrlComplete:r}))}})}catch(n){var e,i;if(!(0,h.kD)(n))return void(0,y.S3)(n,[],a.setError);switch(null==(i=n.errors)||null==(e=i[0])?void 0:e.code){case"organization_not_found_or_unauthorized":case"not_a_member_in_organization":(null==t?void 0:t.createOrganizationEnabled)?a.setError(u((0,l.localizationKeys)("unstable__errors.organization_not_found_or_unauthorized"))):a.setError(u((0,l.localizationKeys)("unstable__errors.organization_not_found_or_unauthorized_with_create_organization_disabled")));break;default:(0,y.S3)(n,[],a.setError)}}})},children:(0,n.tZ)(O.Z,{elementId:"taskChooseOrganization",mainIdentifierSx:z.fq,organization:e.organization})}):null},b=e=>{let t=(0,c.useCardState)(),{getOrganization:a}=(0,i.cL)(),[r,s]=(0,o.useState)(null),{userInvitations:d}=(0,i.eW)({userInvitations:p.AO.userInvitations});return r?(0,n.tZ)(Z,{organization:r}):(0,n.tZ)(z.ij,{organizationData:e.publicOrganizationData,elementId:"taskChooseOrganization",elementDescriptor:l.descriptors.taskChooseOrganizationPreviewItem,children:(0,n.tZ)(z.De,{isLoading:t.isLoading,onClick:()=>t.runAsync(async()=>[await e.accept(),await a(e.publicOrganizationData.id)]).then(e=>{var t;let[a,n]=e;null==d||null==(t=d.setData)||t.call(d,e=>(0,p.Sz)(a,e,"negative")),s(n)}).catch(e=>(0,y.S3)(e,[],t.setError)),localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.action__invitationAccept")})})},S=(0,c.withCardStateProvider)(e=>{let t=(0,c.useCardState)(),{userSuggestions:a}=(0,i.eW)({userSuggestions:p.AO.userSuggestions});return(0,n.tZ)(z.ij,{organizationData:e.publicOrganizationData,elementId:"taskChooseOrganization",elementDescriptor:l.descriptors.taskChooseOrganizationPreviewItem,children:"accepted"===e.status?(0,n.tZ)(l.Text,{colorScheme:"secondary",localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.suggestionsAcceptedLabel")}):(0,n.tZ)(z.De,{onClick:()=>t.runAsync(e.accept).then(e=>{var t;return null==a||null==(t=a.setData)?void 0:t.call(a,t=>(0,p.Sz)(e,t))}).catch(e=>(0,y.S3)(e,[],t.setError)),isLoading:t.isLoading,localizationKey:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.action__suggestionsAccept")})})}),w=e=>{let{onCreateOrganizationClick:t}=e,{user:a}=(0,i.aF)();return(null==a?void 0:a.createOrganizationEnabled)?(0,n.tZ)(m.aU,{elementDescriptor:l.descriptors.taskChooseOrganizationCreateOrganizationActionButton,icon:k.mm,label:(0,l.localizationKeys)("taskChooseOrganization.chooseOrganization.action__createOrganization"),onClick:t,sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$borderAlpha100,padding:"".concat(e.space.$5," ").concat(e.space.$5)}),iconSx:e=>({width:e.sizes.$9,height:e.sizes.$6})}):null};var f=a(70431),K=a(19460),x=a(68487),P=a(7259),$=a(36788);let D=e=>{let t=(0,c.useCardState)(),{navigateOnSetActive:a}=(0,v.G)(),{redirectUrlComplete:o}=(0,v._)(),{createOrganization:s,isLoaded:d,setActive:u}=(0,i.eW)({userMemberships:p.AO.userMemberships}),{organizationSettings:g}=(0,r.useEnvironment)(),h=(0,$.Yp)("name","",{type:"text",label:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formFieldLabel__name"),placeholder:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formFieldInputPlaceholder__name")}),z=(0,$.Yp)("slug","",{type:"text",label:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formFieldLabel__slug"),placeholder:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formFieldInputPlaceholder__slug")}),m=!g.slug.disabled,O=async e=>{if(e.preventDefault(),d)try{let e={name:h.value};m&&(e.slug=z.value);let t=await s(e);await u({organization:t,navigate:async e=>{let{session:t}=e;await (null==a?void 0:a({session:t,redirectUrlComplete:o}))}})}catch(e){(0,y.S3)(e,[h,z],t.setError)}},k=e=>{z.setValue(e)},_=!h.value||!d;return(0,n.BX)(n.HY,{children:[(0,n.BX)(C.h.Root,{showLogo:!0,sx:e=>({padding:"".concat(e.space.$none," ").concat(e.space.$8)}),children:[(0,n.tZ)(C.h.Title,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.title")}),(0,n.tZ)(C.h.Subtitle,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.subtitle")})]}),(0,n.tZ)(x.Y,{sx:e=>({padding:"".concat(e.space.$none," ").concat(e.space.$10," ").concat(e.space.$8)}),children:(0,n.BX)(f.l.Root,{onSubmit:O,children:[(0,n.tZ)(f.l.ControlRow,{elementId:h.id,children:(0,n.tZ)(f.l.PlainInput,{...h.props,onChange:e=>{h.setValue(e.target.value),k((0,P.q)(e.target.value))},isRequired:!0,autoFocus:!0,ignorePasswordManager:!0})}),m&&(0,n.tZ)(f.l.ControlRow,{elementId:z.id,children:(0,n.tZ)(f.l.PlainInput,{...z.props,onChange:e=>k(e.target.value),isRequired:!0,pattern:"^(?=.*[a-z0-9])[a-z0-9\\-]+$",ignorePasswordManager:!0})}),(0,n.BX)(K.K,{sx:()=>({flexDirection:"column"}),children:[(0,n.tZ)(f.l.SubmitButton,{block:!0,isDisabled:_,localizationKey:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formButtonSubmit")}),e.onCancel&&(0,n.tZ)(f.l.ResetButton,{localizationKey:(0,l.localizationKeys)("taskChooseOrganization.createOrganization.formButtonReset"),onClick:e.onCancel})]})]})})]})},I=(0,c.withCardStateProvider)(e=>{let[t,a]=(0,o.useState)(e.initialFlow);return"create"===t?(0,n.tZ)(D,{onCancel:"choose"===e.initialFlow?()=>a("choose"):void 0}):(0,n.tZ)(_,{onCreateOrganizationClick:()=>a("create")})}),A=(0,r.withCoreSessionSwitchGuard)((0,g.U)((0,c.withCardStateProvider)(()=>{var e,t;let{signOut:a}=(0,i.cL)(),{user:o}=(0,i.aF)(),{session:c}=(0,i.kP)(),{userMemberships:g,userSuggestions:h,userInvitations:z}=(0,u.H)(),{otherSessions:p}=(0,d.j)({user:o}),{navigateAfterSignOut:v,navigateAfterMultiSessionSingleSignOutUrl:m}=(0,r.useSignOutContext)(),C=(null==g?void 0:g.isLoading)||(null==z?void 0:z.isLoading)||(null==h?void 0:h.isLoading),O=!!((null==g?void 0:g.count)||(null==z?void 0:z.count)||(null==h?void 0:h.count)),k=null!=(t=null==o||null==(e=o.primaryEmailAddress)?void 0:e.emailAddress)?t:null==o?void 0:o.username;return(0,n.tZ)(l.Flow.Root,{flow:"taskChooseOrganization",children:(0,n.tZ)(l.Flow.Part,{part:"chooseOrganization",children:(0,n.BX)(s.Z.Root,{children:[(0,n.tZ)(s.Z.Content,{sx:e=>({padding:"".concat(e.space.$8," ").concat(e.space.$none," ").concat(e.space.$none),gap:e.space.$7}),children:C?(0,n.tZ)(l.Flex,{direction:"row",align:"center",justify:"center",sx:e=>({height:"100%",minHeight:e.sizes.$100}),children:(0,n.tZ)(l.Spinner,{size:"lg",colorScheme:"primary",elementDescriptor:l.descriptors.spinner})}):(0,n.tZ)(I,{initialFlow:O?"choose":"create"})}),(0,n.tZ)(s.Z.Footer,{children:(0,n.BX)(s.Z.Action,{elementId:"signOut",gap:2,justify:"center",sx:()=>({width:"100%"}),children:[k&&(0,n.tZ)(s.Z.ActionText,{truncate:!0,localizationKey:(0,l.localizationKeys)("taskChooseOrganization.signOut.actionText",{identifier:k})}),(0,n.tZ)(s.Z.ActionLink,{sx:()=>({flexShrink:0}),onClick:()=>0===p.length?a(v):a(m,{sessionId:null==c?void 0:c.id}),localizationKey:(0,l.localizationKeys)("taskChooseOrganization.signOut.actionLink")})]})})]})})})}),"choose-organization"))},25135:function(e,t,a){a.d(t,{U:()=>r});var n=a(95274),i=a(79281),o=a(86988);let r=(e,t)=>{let a=e.displayName||e.name||"Component";e.displayName=a;let r=a=>{let r=(0,o.G)();return(0,i.me)(e,e=>{var a;return!(null==(a=e.session)?void 0:a.currentTask)||e.session.currentTask.key!==t&&!e.__internal_setActiveInProgress},e=>{var t;let{clerk:a}=e;return a.session?null!=(t=r.redirectUrlComplete)?t:a.buildAfterSignInUrl():a.buildSignInUrl()},n.q.cannotRenderComponentWhenTaskDoesNotExist)(a)};return r.displayName="withTaskGuard(".concat(a,")"),r}}}]);