"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["7814"],{7484:function(e,t,a){a.d(t,{AO:()=>i,Sz:()=>n});let i={userMemberships:{infinite:!0},userInvitations:{infinite:!0},userSuggestions:{infinite:!0,status:["pending","accepted"]}},n=(e,t,a)=>{if(void 0===t)return[{data:[e],total_count:1}];let i=t?.[t.length-1]?.total_count||1;return t.map(t=>{if(void 0===t)return t;let n=t.data.map(t=>t.id===e.id?{...e}:t);return{...t,data:n,total_count:"negative"===a?i-1:i}})}},3738:function(e,t,a){a.r(t),a.d(t,{TaskChooseOrganization:()=>A});var i=a(3312),n=a(1869),o=a(9144),r=a(1576),s=a(4204),l=a(2418),c=a(2672),d=a(4264),g=a(6028),u=a(5135),h=a(1024),z=a(237),p=a(7484),m=a(6988),C=a(2305),O=a(2654),k=a(5973),y=a(4174),_=a(8870);let Z=e=>{let t=(0,c.useCardState)(),{ref:a,userMemberships:n,userSuggestions:o,userInvitations:r}=(0,g.H)(),d=n?.isLoading||r?.isLoading||o?.isLoading,u=n?.hasNextPage||r?.hasNextPage||o?.hasNextPage,h=r.data?.filter(e=>!!e),p=o.data?.filter(e=>!!e);return(0,i.BX)(i.HY,{children:[(0,i.BX)(O.h.Root,{showLogo:!0,sx:e=>({padding:`${e.space.$none} ${e.space.$8}`}),children:[(0,i.tZ)(O.h.Title,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.title")}),(0,i.tZ)(O.h.Subtitle,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.subtitle")})]}),(0,i.tZ)(l.Z.Alert,{sx:e=>({margin:`${e.space.$none} ${e.space.$8}`}),children:t.error}),(0,i.tZ)(s.Col,{elementDescriptor:s.descriptors.main,children:(0,i.tZ)(z.o2,{elementDescriptor:s.descriptors.taskChooseOrganizationPreviewItems,children:(0,i.BX)(C.eX,{role:"menu",children:[(n.count||0)>0&&n.data?.map(e=>(0,i.tZ)(b,{...e},e.id)),!n.hasNextPage&&h?.map(e=>(0,i.tZ)(S,{...e},e.id)),!n.hasNextPage&&!r.hasNextPage&&p?.map(e=>(0,i.tZ)($,{...e},e.id)),(u||d)&&(0,i.tZ)(z.pr,{ref:a}),(0,i.tZ)(w,{onCreateOrganizationClick:()=>{t.setError(void 0),e.onCreateOrganizationClick()}})]})})})]})},b=e=>{let{user:t}=(0,n.aF)(),a=(0,c.useCardState)(),{navigateOnSetActive:o}=(0,m.G)(),{redirectUrlComplete:r}=(0,m._)(),{isLoaded:l,setActive:d}=(0,n.eW)(),{t:g}=(0,s.useLocalizations)();return l?(0,i.tZ)(z.Td,{elementDescriptor:s.descriptors.taskChooseOrganizationPreviewButton,onClick:()=>{let i;return i=e.organization,a.runAsync(async()=>{try{await d({organization:i,navigate:async({session:e})=>{await o?.({session:e,redirectUrlComplete:r})}})}catch(e){if(!(0,h.kD)(e))return void(0,_.S3)(e,[],a.setError);switch(e.errors?.[0]?.code){case"organization_not_found_or_unauthorized":case"not_a_member_in_organization":t?.createOrganizationEnabled?a.setError(g((0,s.localizationKeys)("unstable__errors.organization_not_found_or_unauthorized"))):a.setError(g((0,s.localizationKeys)("unstable__errors.organization_not_found_or_unauthorized_with_create_organization_disabled")));break;default:(0,_.S3)(e,[],a.setError)}}})},children:(0,i.tZ)(k.Z,{elementId:"taskChooseOrganization",mainIdentifierSx:z.fq,organization:e.organization})}):null},S=e=>{let t=(0,c.useCardState)(),{getOrganization:a}=(0,n.cL)(),[r,l]=(0,o.useState)(null),{userInvitations:d}=(0,n.eW)({userInvitations:p.AO.userInvitations});return r?(0,i.tZ)(b,{organization:r}):(0,i.tZ)(z.ij,{organizationData:e.publicOrganizationData,elementId:"taskChooseOrganization",elementDescriptor:s.descriptors.taskChooseOrganizationPreviewItem,children:(0,i.tZ)(z.De,{isLoading:t.isLoading,onClick:()=>t.runAsync(async()=>[await e.accept(),await a(e.publicOrganizationData.id)]).then(([e,t])=>{d?.setData?.(t=>(0,p.Sz)(e,t,"negative")),l(t)}).catch(e=>(0,_.S3)(e,[],t.setError)),localizationKey:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.action__invitationAccept")})})},$=(0,c.withCardStateProvider)(e=>{let t=(0,c.useCardState)(),{userSuggestions:a}=(0,n.eW)({userSuggestions:p.AO.userSuggestions});return(0,i.tZ)(z.ij,{organizationData:e.publicOrganizationData,elementId:"taskChooseOrganization",elementDescriptor:s.descriptors.taskChooseOrganizationPreviewItem,children:"accepted"===e.status?(0,i.tZ)(s.Text,{colorScheme:"secondary",localizationKey:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.suggestionsAcceptedLabel")}):(0,i.tZ)(z.De,{onClick:()=>t.runAsync(e.accept).then(e=>a?.setData?.(t=>(0,p.Sz)(e,t))).catch(e=>(0,_.S3)(e,[],t.setError)),isLoading:t.isLoading,localizationKey:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.action__suggestionsAccept")})})}),w=({onCreateOrganizationClick:e})=>{let{user:t}=(0,n.aF)();return t?.createOrganizationEnabled?(0,i.tZ)(C.aU,{elementDescriptor:s.descriptors.taskChooseOrganizationCreateOrganizationActionButton,icon:y.mm,label:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.action__createOrganization"),onClick:e,sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$borderAlpha100,padding:`${e.space.$5} ${e.space.$5}`}),iconSx:e=>({width:e.sizes.$9,height:e.sizes.$6})}):null};var f=a(431),v=a(9460),K=a(8487),x=a(7259),P=a(6788);let D=e=>{let t=(0,c.useCardState)(),{navigateOnSetActive:a}=(0,m.G)(),{redirectUrlComplete:o}=(0,m._)(),{createOrganization:l,isLoaded:d,setActive:g}=(0,n.eW)({userMemberships:p.AO.userMemberships}),{organizationSettings:u}=(0,r.useEnvironment)(),h=(0,P.Yp)("name","",{type:"text",label:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formFieldLabel__name"),placeholder:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formFieldInputPlaceholder__name")}),z=(0,P.Yp)("slug","",{type:"text",label:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formFieldLabel__slug"),placeholder:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formFieldInputPlaceholder__slug")}),C=!u.slug.disabled,k=async e=>{if(e.preventDefault(),d)try{let e={name:h.value};C&&(e.slug=z.value);let t=await l(e);await g({organization:t,navigate:async({session:e})=>{await a?.({session:e,redirectUrlComplete:o})}})}catch(e){(0,_.S3)(e,[h,z],t.setError)}},y=e=>{z.setValue(e)},Z=!h.value||!d;return(0,i.BX)(i.HY,{children:[(0,i.BX)(O.h.Root,{showLogo:!0,sx:e=>({padding:`${e.space.$none} ${e.space.$8}`}),children:[(0,i.tZ)(O.h.Title,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.title")}),(0,i.tZ)(O.h.Subtitle,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.subtitle")})]}),(0,i.tZ)(K.Y,{sx:e=>({padding:`${e.space.$none} ${e.space.$10} ${e.space.$8}`}),children:(0,i.BX)(f.l.Root,{onSubmit:k,children:[(0,i.tZ)(f.l.ControlRow,{elementId:h.id,children:(0,i.tZ)(f.l.PlainInput,{...h.props,onChange:e=>{h.setValue(e.target.value),y((0,x.q)(e.target.value))},isRequired:!0,autoFocus:!0,ignorePasswordManager:!0})}),C&&(0,i.tZ)(f.l.ControlRow,{elementId:z.id,children:(0,i.tZ)(f.l.PlainInput,{...z.props,onChange:e=>y(e.target.value),isRequired:!0,pattern:"^(?=.*[a-z0-9])[a-z0-9\\-]+$",ignorePasswordManager:!0})}),(0,i.BX)(v.K,{sx:()=>({flexDirection:"column"}),children:[(0,i.tZ)(f.l.SubmitButton,{block:!0,isDisabled:Z,localizationKey:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formButtonSubmit")}),e.onCancel&&(0,i.tZ)(f.l.ResetButton,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formButtonReset"),onClick:e.onCancel})]})]})})]})},I=(0,c.withCardStateProvider)(e=>{let[t,a]=(0,o.useState)(e.initialFlow);return"create"===t?(0,i.tZ)(D,{onCancel:"choose"===e.initialFlow?()=>a("choose"):void 0}):(0,i.tZ)(Z,{onCreateOrganizationClick:()=>a("create")})}),A=(0,r.withCoreSessionSwitchGuard)((0,u.U)((0,c.withCardStateProvider)(()=>{let{signOut:e}=(0,n.cL)(),{user:t}=(0,n.aF)(),{session:a}=(0,n.kP)(),{userMemberships:o,userSuggestions:c,userInvitations:u}=(0,g.H)(),{otherSessions:h}=(0,d.j)({user:t}),{navigateAfterSignOut:z,navigateAfterMultiSessionSingleSignOutUrl:p}=(0,r.useSignOutContext)(),m=o?.isLoading||u?.isLoading||c?.isLoading,C=!!(o?.count||u?.count||c?.count),O=t?.primaryEmailAddress?.emailAddress??t?.username;return(0,i.tZ)(s.Flow.Root,{flow:"taskChooseOrganization",children:(0,i.tZ)(s.Flow.Part,{part:"chooseOrganization",children:(0,i.BX)(l.Z.Root,{children:[(0,i.tZ)(l.Z.Content,{sx:e=>({padding:`${e.space.$8} ${e.space.$none} ${e.space.$none}`,gap:e.space.$7}),children:m?(0,i.tZ)(s.Flex,{direction:"row",align:"center",justify:"center",sx:e=>({height:"100%",minHeight:e.sizes.$100}),children:(0,i.tZ)(s.Spinner,{size:"lg",colorScheme:"primary",elementDescriptor:s.descriptors.spinner})}):(0,i.tZ)(I,{initialFlow:C?"choose":"create"})}),(0,i.tZ)(l.Z.Footer,{children:(0,i.BX)(l.Z.Action,{elementId:"signOut",gap:2,justify:"center",sx:()=>({width:"100%"}),children:[O&&(0,i.tZ)(l.Z.ActionText,{truncate:!0,localizationKey:(0,s.localizationKeys)("taskChooseOrganization.signOut.actionText",{identifier:O})}),(0,i.tZ)(l.Z.ActionLink,{sx:()=>({flexShrink:0}),onClick:()=>0===h.length?e(z):e(p,{sessionId:a?.id}),localizationKey:(0,s.localizationKeys)("taskChooseOrganization.signOut.actionLink")})]})})]})})})}),"choose-organization"))},5135:function(e,t,a){a.d(t,{U:()=>r});var i=a(5274),n=a(9281),o=a(6988);let r=(e,t)=>{let a=e.displayName||e.name||"Component";e.displayName=a;let r=a=>{let r=(0,o.G)();return(0,n.me)(e,e=>!e.session?.currentTask||e.session.currentTask.key!==t&&!e.__internal_setActiveInProgress,({clerk:e})=>e.session?r.redirectUrlComplete??e.buildAfterSignInUrl():e.buildSignInUrl(),i.q.cannotRenderComponentWhenTaskDoesNotExist)(a)};return r.displayName=`withTaskGuard(${a})`,r}}}]);